# Backend for a hotel app

### Бэкенд-составляющая сервиса бронирования отелей. Это приложение позволяет бронировать комнаты в отеле на необходимые даты с возможностью администрирования и получения статистики

### Особенности
- Разграничение ролей (USER, ADMIN), аутентификация через Basic Auth;
- Гибкая фильтрация при выборе отелей и комнат, при помощи JPA Specification;
- MapStruct: для удобства ввода информации и безопасного вывода используется ряд сущностей DTO, мэпинг которых полностью осуществляется при помощи библиотеки MapStruct;
- Spring Boot: управление зависимостями и структурой приложения, REST API;
- PostgreSQL: база данных для хранения информации об отелях, пользователях, бронировании и комнатах.
- Сбор статистики: приложение собирает информацию о создании новых броней и пользователях, используя Kafka и ZooKeeper для передачи информации в раздельных топиках, а для хранения используется MongoDB;
- Выгрузка статистики в csv файл.
  

### Стек

- Java (JDK 21);
- Spring Boot: фреймворк для управления зависимостями и создания REST API;
- Hibernate: ORM для работы с базами данных;
- PostgreSQL: для хранения основных сущностей приложения;
- MongoDB: для хранения событий создания новых пользователей и броней;
- Kafka и ZooKeeper: создание и сохранение событий для формирования последующей статистики новых пользователей и броней;
- Docker: контейнеризация для упрощения запуска и развертывания.

### Установка и настройка

#### Для запуска проекта необходимы:

- Java 21;
- MongoDB;
- PostgreSQL;
- Kafka и ZooKeeper;
- Docker.

Потребуется клонировать репозиторий и собрать проект при помощи Maven:<br>
    
    ./gradlew build

Далее из склонированного репозитория запускается docker-контейнер при помощи docker-compose файла:<br>

    docker-compose up

Остается запустить приложение:<br>

    java -jar ./hotel-app-0.0.1-SNAPSHOT.jar

### API Endpoints

#### Users API

- /users/{username} (GET): возвращает пользователя по переданному username;
- /users (POST): создает нового пользователя;
- /users (PUT): изменяет существующего пользователя;
- /users (DELETE): удаляет пользователя;
- /users (GET): возвращает список всех пользователей.

#### Rooms API

- /rooms/{id} (GET): возвращает комнату по id;
- /rooms (POST): создает новую комнату;
- /rooms (PUT): изменяет существующую комнату;
- /rooms/{id} (DELETE): удаляет комнату;
- /rooms (GET): возвращает список всех комнат;
- /rooms/filter (GET): возвращает список комнат соответствующих параметрам.

#### Hotels API

- /hotels/{id} (GET): возвращает отель по id;
- /hotels (POST): создает новый отель;
- /hotels (PUT): изменяет существующий отель;
- /hotels (DELETE): удаляет отель;
- /hotels (GET): возвращает список всех отелей;
- /hotels/filter (GET): возвращает список отелей соответствующих параметрам.

#### Booking API

- /booking/{id} (GET): возвращает бронь по id;
- /booking (POST): создает новую бронь;
- /booking (PUT): изменяет существующую бронь;
- /booking (DELETE): удаляет бронь;
- /booking (GET): возвращает список всех броней;

#### Statistics API

- /statistics (GET): возвращает статистику по созданным пользователям и броням в формате csv.


### Как это работает

1. Создаются пользователи с ролями USER/ADMIN (*);
   1. В топик "user-registration" в Kafka попадает сообщение с объектом ``UserRegistrationEvent``;
   2. ``StatisticsListener`` считывает сообщения из топика и сохраняет объект в MongoDB. 
2. Пользователь с ролью ADMIN может создавать и редактировать отели;
3. Пользователь с ролью ADMIN может создавать и редактировать комнаты. Комнаты создаются с привязкой к существующим отелям.
4. Любой пользователь может создать бронь на свободную дату в выбранной комнате.
    1. В топик "room-booking" в Kafka попадает сообщение с объектом ``RoomBookingEvent``;
    2. ``StatisticsListener`` считывает сообщения из топика и сохраняет объект в MongoDB.

